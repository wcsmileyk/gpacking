{% extends 'base.html' %}

{% block content %}
    <div class="container">
        <form class="form" action="" method="post">
            {% if form.errors %}
          <div class="alert alert-danger">{{ form.errors }}</div>
            {% endif %}
            {{ form.csrf_token }}
          <div class="form-group">
            <label for="name" class="col-sm-2 control-label">Item Name</label>
            <div class="col-sm-10">
              <input type="text" name="name" class="form-control" id="name">
            </div>
          </div>
          <div class="form-group">
            <label for="category" class="col-sm-2 control-label">Category</label>
            <div class="col-sm-10">
               {{ form.category(class_='form-control') }}
            </div>
          </div>
          <div class="form-group">
            <label for="type" class="col-sm-2 control-label">Type</label>
            <div class="col-sm-10">
                <select name="type" id="type", class="form-control">

                </select>
            </div>
          </div>
          <div class="form-group">
              <label for="weight" class="col-sm-2 control-label">Weight(kgs)</label>
              <div class="col-sm-10">
                  <input type="number" name="weight" class="form-control" id="weight">
              </div>
          </div>
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <button type="submit" class="btn btn-default">Add Item</button>
            </div>
          </div>
        </form>
    </div>

    <div class="container">
        <h2>{{ inventory.name }}</h2>

        {% for category in categories %}
            <table class="table table-condensed table-hover">
                <caption>{{ category.name }}</caption>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Weight</th>
                    </tr>
                </thead>
                <tbody>
                {% for item in inventory.items %}
                    {% if item.category.name == category.name  %}
                        <tr>
                            <td>{{ item.name }}</td>
                            <td>{{ item.type.name }}</td>
                            <td>{{ item.weight }}</td>
                        </tr>
                    {% endif %}
                {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    </div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script type=text/javascript>
{#TODO: Fix option population so it resets on refresh#}
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>
<script type="text/javascript">
  $(function() {
      var get_opts = function (e) {
          $.getJSON($SCRIPT_ROOT + '/create_opts', {
              a: $('#category').val()
          }, function (data) {
              $('#type option').remove();
              $.each(data.result, function( key, value ) {
                  $('#type').append('<option value=' + value[0] + '>' + value[1] + '</option>')
              })
          });
          return false;
      };

      $('#category').change(get_opts);
  })
</script>
{% endblock %}
